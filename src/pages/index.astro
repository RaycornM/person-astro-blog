---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import IntroCard from '../components/IntroCard.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection } from 'astro:content';

// Use import.meta.glob for blog posts
type Post = {
  url: string;
  frontmatter: {
    title: string;
    pubDate: string;
    description: string;
    heroImage?: string;
  };
};

const posts = await getCollection('blog');
const sortedPosts = posts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime());
const [latestPost, ...otherPosts] = sortedPosts.slice(0, 3);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<p style="text-align: center;">
    			🍵欢迎来到日暮茶会...
    			<br />
    			要先来一杯红茶吗？
			</p>
			 <IntroCard title="マスカレード" description="…ようこそ。新日暮里の世界へ" />

            <section>
                <h2 class="latest-post">最新文章</h2>
                {latestPost && (
                    <a href={`/blog/${latestPost.id}/`} class="post-card featured">
                        <img 
                            src={
                                latestPost.data.heroImage
                                    ? typeof latestPost.data.heroImage === 'string'
                                        ? latestPost.data.heroImage
                                        : latestPost.data.heroImage.src
                                    : '/assets/blog-placeholder-about.jpg'
                            }
                            alt={latestPost.data.title} 
                            style="width: 100%; height: 220px; object-fit: cover; display: block; border-top-left-radius: 1rem; border-top-right-radius: 1rem;"
                            class="post-image"
                        />
                        <div style="padding: 2rem;">
                            <h3 style="margin-top: 0;font-family: 'SmileySans-Oblique';">{latestPost.data.title}</h3>
                            <p style="color: #888;">{new Date(latestPost.data.pubDate).toLocaleDateString()}</p>
                            <p>{latestPost.data.description}</p>
                        </div>
                    </a>
                )}
                <div class="post-row">
                    {otherPosts.map(post => (
                        <a href={`/blog/${post.id}/`} class="post-card">
                            <img
                              src={
                                post.data.heroImage
                                  ? typeof post.data.heroImage === 'string'
                                    ? post.data.heroImage
                                    : post.data.heroImage.src
                                  : '/assets/blog-placeholder-about.jpg'
                              }
                              alt={post.data.title}
                              style="width: 100%; height: 140px; object-fit: cover; display: block; border-top-left-radius: 1rem; border-top-right-radius: 1rem;"
                              class="post-image"
                            />
                            <div style="padding: 1.5rem;">
                                <h3 style="margin-top: 0;font-family: 'SmileySans-Oblique';">{post.data.title}</h3>
                                <p style="color: #888;">{new Date(post.data.pubDate).toLocaleDateString()}</p>
                                <p>{post.data.description}</p>
                            </div>
                        </a>
                    ))}
                </div>
            </section>
		</main>
		<Footer />
	</body>
</html>

<style>
.post-card {
    background: #fff;
    border-radius: 1rem;
    box-shadow: 0 4px 16px rgba(0,0,0,0.10);
    padding: 0;
    text-decoration: none;
    color: inherit;
    overflow: hidden;
    transition: transform 0.2s cubic-bezier(.4,2,.6,1), box-shadow 0.2s;
    will-change: transform, box-shadow;
    display: block;
}
.post-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    z-index: 1;
}
.post-card:hover .post-image {
    transform: scale(1.06) rotate(-1deg);
}
.post-card.featured {
    margin-bottom: 2rem;
}
.post-row {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
}
.post-row .post-card {
    flex: 1 1 300px;
    max-width: 48%;
}
@media (max-width: 800px) {
    .post-row {
        flex-direction: column;
    }
    .post-row .post-card {
        max-width: 100%;
    }
}
</style>
